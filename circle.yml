machine:
  pre:
    - sudo sed -i "s|dbms.security.auth_enabled=true|dbms.security.auth_enabled=false|g" /etc/neo4j/neo4j-server.properties
    - sudo sh -c "echo 'org.neo4j.server.thirdparty_jaxrs_classes=com.graphaware.server=/graphaware' >> /etc/neo4j/neo4j-server.properties"
    - sudo cp tasks/tools/neo4j/plugins/* /usr/share/neo4j/plugins/
  services:
    - docker
    - neo4j
  node:
    version: v5.6.0

dependencies:
  override:
    - npm install

test:
  override:
    - npm test
    - npm run coveralls
  post:
    - docker info
    - docker build -t echion-tasks .

deployment:
  master:
    branch: master
    commands:
      - docker tag echion-tasks:latest $AWS_ECR_URL/echion-tasks:latest
      - docker push $AWS_ECR_URL/echion-tasks:latest

general:
  artifacts:
    - ./coverage